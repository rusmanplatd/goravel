{{define "oauth/providers/templates.tmpl"}}
    {{template "layouts/header.tmpl" .}}

    <!-- Google-like OAuth Provider Templates Styles -->
    <style>
        .templates-gallery {
            font-family: 'Google Sans', 'Roboto', sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
        }
        
        .template-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 1px solid #dadce0;
            overflow: hidden;
            height: 100%;
        }
        
        .template-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .template-header {
            padding: 24px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
        }
        
        .template-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            margin-right: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }
        
        .template-info h3 {
            margin: 0 0 4px 0;
            font-size: 18px;
            font-weight: 500;
            color: #202124;
        }
        
        .template-info p {
            margin: 0;
            font-size: 14px;
            color: #5f6368;
        }
        
        .template-body {
            padding: 24px;
        }
        
        .template-features {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
        }
        
        .template-features li {
            padding: 8px 0;
            font-size: 14px;
            color: #5f6368;
            display: flex;
            align-items: center;
        }
        
        .template-features li i {
            color: #34a853;
            margin-right: 8px;
            width: 16px;
        }
        
        .template-footer {
            padding: 16px 24px;
            border-top: 1px solid #f0f0f0;
            background: #f8f9fa;
        }
        
        .btn-google {
            background: #1a73e8;
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s ease;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
            width: 100%;
            text-align: center;
        }
        
        .btn-google:hover {
            background: #1557b0;
            color: white;
            text-decoration: none;
        }
        
        .btn-outline-google {
            background: transparent;
            border: 1px solid #dadce0;
            color: #5f6368;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s ease;
            font-size: 14px;
            text-decoration: none;
            margin-right: 8px;
        }
        
        .btn-outline-google:hover {
            background: #f8f9fa;
            border-color: #1a73e8;
            color: #1a73e8;
            text-decoration: none;
        }
        
        .page-header {
            background: white;
            border-bottom: 1px solid #dadce0;
            padding: 32px 0;
            margin-bottom: 32px;
        }
        
        .search-box {
            position: relative;
            max-width: 400px;
            margin: 0 auto 32px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 48px;
            border: 1px solid #dadce0;
            border-radius: 24px;
            font-size: 14px;
            outline: none;
            transition: all 0.2s ease;
        }
        
        .search-box input:focus {
            border-color: #1a73e8;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .search-box i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #5f6368;
        }
        
        .category-filter {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }
        
        .category-btn {
            padding: 8px 16px;
            border: 1px solid #dadce0;
            border-radius: 20px;
            background: white;
            color: #5f6368;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .category-btn:hover,
        .category-btn.active {
            background: #1a73e8;
            color: white;
            border-color: #1a73e8;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .setup-modal .modal-body {
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .setup-step {
            display: flex;
            margin-bottom: 20px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .step-number {
            width: 32px;
            height: 32px;
            background: #1a73e8;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 14px;
            margin-right: 16px;
            flex-shrink: 0;
        }
        
        .step-content h5 {
            margin: 0 0 8px 0;
            font-size: 16px;
            color: #202124;
        }
        
        .step-content p {
            margin: 0;
            font-size: 14px;
            color: #5f6368;
        }
    </style>

    <div class="templates-gallery">
        <!-- Page Header -->
        <div class="page-header">
            <div class="container">
                <div class="row">
                    <div class="col-12 text-center">
                        <h1 class="h2 fw-normal mb-3" style="color: #202124;">OAuth Provider Templates</h1>
                        <p class="text-muted mb-4">Choose from pre-configured templates to quickly set up popular OAuth providers</p>
                        
                        <!-- Search Box -->
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="templateSearch" placeholder="Search providers..." onkeyup="filterTemplates()">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Category Filter -->
        <div class="container">
            <div class="category-filter">
                <button class="category-btn active" onclick="filterByCategory('all')">All Providers</button>
                <button class="category-btn" onclick="filterByCategory('social')">Social Media</button>
                <button class="category-btn" onclick="filterByCategory('professional')">Professional</button>
                <button class="category-btn" onclick="filterByCategory('developer')">Developer Tools</button>
                <button class="category-btn" onclick="filterByCategory('enterprise')">Enterprise</button>
            </div>

            <!-- Templates Grid -->
            <div class="row" id="templatesGrid">
                {{range .templates}}
                <div class="col-lg-4 col-md-6 mb-4 template-item fade-in" 
                     data-name="{{.DisplayName}}" 
                     data-category="{{if eq .Name "facebook"}}social{{else if eq .Name "twitter"}}social{{else if eq .Name "linkedin"}}professional{{else if eq .Name "github"}}developer{{else if eq .Name "discord"}}social{{else if eq .Name "slack"}}professional{{else if eq .Name "microsoft"}}enterprise{{else if eq .Name "google"}}enterprise{{else}}other{{end}}">
                    <div class="template-card">
                        <div class="template-header">
                            <div class="template-icon" style="background-color: {{.ButtonColor}};">
                                {{if .IconURL}}
                                    <img src="{{.IconURL}}" alt="{{.DisplayName}}" style="width: 32px; height: 32px; border-radius: 4px;">
                                {{else}}
                                    <i class="fas fa-cube"></i>
                                {{end}}
                            </div>
                            <div class="template-info">
                                <h3>{{.DisplayName}}</h3>
                                <p>{{.Description}}</p>
                            </div>
                        </div>
                        
                        <div class="template-body">
                            <ul class="template-features">
                                <li><i class="fas fa-check"></i> OAuth 2.0 compliant</li>
                                <li><i class="fas fa-check"></i> Pre-configured endpoints</li>
                                <li><i class="fas fa-check"></i> Secure token handling</li>
                                <li><i class="fas fa-check"></i> User profile mapping</li>
                                {{if .Documentation}}
                                <li><i class="fas fa-check"></i> Complete documentation</li>
                                {{end}}
                            </ul>
                        </div>
                        
                        <div class="template-footer">
                            <button class="btn btn-google" onclick="showSetupModal('{{.Name}}')">
                                <i class="fas fa-plus me-2"></i>
                                Use Template
                            </button>
                        </div>
                    </div>
                </div>
                {{end}}
            </div>
            
            <!-- No Results Message -->
            <div id="noResults" class="text-center py-5" style="display: none;">
                <i class="fas fa-search text-muted" style="font-size: 48px; opacity: 0.3;"></i>
                <h4 class="mt-3 text-muted">No templates found</h4>
                <p class="text-muted">Try adjusting your search or filter criteria</p>
            </div>
        </div>
    </div>

    <!-- Setup Modal -->
    <div class="modal fade setup-modal" id="setupModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Set up <span id="modalProviderName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="setupSteps"></div>
                    
                    <hr>
                    
                    <form id="templateForm">
                        <input type="hidden" id="templateName" name="template">
                        
                        <div class="mb-3">
                            <label for="clientId" class="form-label-google">Client ID</label>
                            <input type="text" class="form-control form-control-google" id="clientId" name="client_id" required>
                            <div class="form-text">Your OAuth application's client ID</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="clientSecret" class="form-label-google">Client Secret</label>
                            <input type="password" class="form-control form-control-google" id="clientSecret" name="client_secret" required>
                            <div class="form-text">Your OAuth application's client secret</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="redirectUrl" class="form-label-google">Redirect URL</label>
                            <input type="url" class="form-control form-control-google" id="redirectUrl" name="redirect_url" required>
                            <div class="form-text">The callback URL for your application</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-google" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-google" onclick="createFromTemplate()">
                        <i class="fas fa-plus me-2"></i>
                        Create Provider
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTemplate = null;
        
        // Filter templates by search
        function filterTemplates() {
            const searchTerm = document.getElementById('templateSearch').value.toLowerCase();
            const templates = document.querySelectorAll('.template-item');
            let visibleCount = 0;
            
            templates.forEach(template => {
                const name = template.dataset.name.toLowerCase();
                const isVisible = name.includes(searchTerm);
                template.style.display = isVisible ? 'block' : 'none';
                if (isVisible) visibleCount++;
            });
            
            document.getElementById('noResults').style.display = visibleCount === 0 ? 'block' : 'none';
        }
        
        // Filter templates by category
        function filterByCategory(category) {
            // Update active button
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const templates = document.querySelectorAll('.template-item');
            let visibleCount = 0;
            
            templates.forEach(template => {
                const templateCategory = template.dataset.category;
                const isVisible = category === 'all' || templateCategory === category;
                template.style.display = isVisible ? 'block' : 'none';
                if (isVisible) visibleCount++;
            });
            
            document.getElementById('noResults').style.display = visibleCount === 0 ? 'block' : 'none';
        }
        
        // Show setup modal
        async function showSetupModal(templateName) {
            try {
                const response = await fetch(`/oauth/providers/templates/${templateName}`);
                const template = await response.json();
                
                currentTemplate = template;
                
                // Update modal content
                document.getElementById('modalProviderName').textContent = template.display_name;
                document.getElementById('templateName').value = template.name;
                
                // Generate setup steps
                let stepsHTML = '';
                if (template.setup_instructions) {
                    stepsHTML = '<h6 class="mb-3">Setup Instructions:</h6>';
                    template.setup_instructions.forEach(step => {
                        stepsHTML += `
                            <div class="setup-step">
                                <div class="step-number">${step.step}</div>
                                <div class="step-content">
                                    <h5>${step.title}</h5>
                                    <p>${step.description}</p>
                                    ${step.url ? `<a href="${step.url}" target="_blank" class="btn-outline-google">Open ${step.title}</a>` : ''}
                                </div>
                            </div>
                        `;
                    });
                }
                
                document.getElementById('setupSteps').innerHTML = stepsHTML;
                
                // Set default redirect URL
                const currentDomain = window.location.origin;
                document.getElementById('redirectUrl').value = `${currentDomain}/auth/oauth/${template.name}/callback`;
                
                // Show modal
                new bootstrap.Modal(document.getElementById('setupModal')).show();
                
            } catch (error) {
                console.error('Error loading template:', error);
                alert('Failed to load template details');
            }
        }
        
        // Create provider from template
        async function createFromTemplate() {
            const form = document.getElementById('templateForm');
            const formData = new FormData(form);
            
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            try {
                const response = await fetch('/oauth/providers/from-template', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || ''
                    },
                    body: JSON.stringify({
                        template: formData.get('template'),
                        client_id: formData.get('client_id'),
                        client_secret: formData.get('client_secret'),
                        redirect_url: formData.get('redirect_url')
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert('Provider created successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('setupModal')).hide();
                    window.location.href = '/oauth/providers';
                } else {
                    alert(result.message || 'Failed to create provider');
                }
                
            } catch (error) {
                console.error('Error creating provider:', error);
                alert('Failed to create provider');
            }
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Add fade-in animation to template cards
            document.querySelectorAll('.template-item').forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('fade-in');
                }, index * 100);
            });
        });
    </script>

    {{template "layouts/footer.tmpl" .}}
{{end}} 